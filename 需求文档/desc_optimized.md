# ACFUN直播工具箱需求文档

## 1. 项目概述

ACFUN直播工具箱是一款基于Electron开发的跨平台直播辅助工具，支持Windows、macOS和Linux系统。工具采用主客户端+小程序架构，主客户端聚焦核心直播管理功能，通过小程序系统提供丰富的扩展能力，为ACFUN直播平台的主播提供高效、灵活的直播辅助解决方案。

### 1.1 项目定位
- **目标用户**：ACFUN平台主播
- **核心价值**：主客户端提供稳定可靠的核心直播管理功能，小程序系统提供丰富多样的扩展能力，共同提升直播效率，优化观众互动体验
- **竞争优势**：开源免费、核心功能稳定、小程序生态丰富、跨平台支持

### 1.2 架构设计
- **主客户端**：聚焦核心模块，包括仪表盘、房间管理、系统设置等基础功能
- **小程序系统**：使用微前端架构，承载可扩展功能，如弹幕互动、超级聊、数据分析等，不在本项目开发
- **通信机制**：主客户端与小程序通过标准化接口进行通信，确保高效集成与运行管控


## 2. 用户核心诉求

### 2.1 主播用户
- 简化直播开播流程，快速完成房间设置
- 实时监控直播状态和观众互动
- 高效管理弹幕，过滤不良信息
- 扩展直播功能，提升观众体验
- 数据分析与复盘

## 3. 功能模块划分

### 3.1 主客户端核心模块
#### 3.1.1 仪表盘模块
- **欢迎信息展示**：显示个性化欢迎信息和用户昵称
- **核心数据概览**：展示直播关键指标（观众数、礼物数等）
- **背景视觉效果**：左侧底部展示半透明背景动画图

#### 3.1.2 用户认证模块
- **登录系统**：支持二维码登录、账号密码登录和游客模式
- **状态管理**：会话维护、登录状态检测和自动登录
- **权限控制**：基于角色的权限系统、接口权限验证和功能访问控制

#### 3.1.3 直播管理模块
- **房间管理**：房间信息设置（封面、标题、分区）、房间信息获取、观众剪辑权限控制、管理员管理、观众管理
- **推流管理**：推流准备、推流会话管理（RTMP服务器信息、直播码）、推流启动、推流状态监控、转码管理、OBS同步推流、下播控制，引入obs-websocket进行
- **直播信息展示**：欢迎面板、直播状态统计

#### 3.1.4 数据分析模块
- **实时统计数据**：观看人数、礼物收入、弹幕数量
- **观众行为分析**：观众来源、观看时长、互动行为
- **礼物数据统计**：收入统计、用户排行、类型分布
- **数据报表**：完播复盘、历史数据分析、趋势对比

#### 3.1.5 小本本功能
- 管理房管、黑名单等

#### 3.1.6 系统设置模块
- **通用设置**：界面主题、语言设置、配置储存路径、弹幕保存路径、配置备份与恢复、通知设置
- **网络设置**：后端端口配置、状态、日志、端口冲突检测
- **快捷键设置**：全局快捷键、分区快捷键
- **服务器配置**：
  - 默认服务器：`localhost:15368`（开发环境）
  - 生产环境：自动使用当前域名
- **网络检测**：通过网络检测函数确认连接状态
- **界面主题**：支持明暗主题切换
- **语言设置**：支持多语言切换
- **字体设置**：调整界面字体大小和类型
- **通知设置**：配置消息通知方式和频率

#### 3.1.7 错误处理模块
- **错误页面展示**：友好的错误提示
- **错误信息反馈**：清晰的错误描述和导航建议
- **返回机制**：便捷的返回按钮

### 3.2 小程序系统模块（主客户端管理能力）
#### 3.2.1 小程序管理
- **小程序列表展示**：显示可用的小程序及其描述
- **小程序启动和配置**：一键启动、参数配置
- **小程序状态监控**：实时监控小程序运行状态

#### 3.2.2 小程序市场
- **小程序安装与更新**：一键导入、导出，预留更新接口

#### 3.2.3 开发者支持
- **开发框架**：提供小程序开发SDK
- **API文档**：详细的开发指南和示例
- **调试工具**：小程序调试和测试工具

### 3.3 可解耦为小程序的功能模块
#### 3.3.1 弹幕系统小程序
- **弹幕处理**： 弹幕展示、弹幕过滤、弹幕合并
- **弹幕展示**：流式展示、自定义滚动速度和样式、交互功能

#### 3.3.2 超级聊小程序
- **功能开关**：总开关、观众端开关
- **规则配置**：金额阈值、显示持续时间、主题选择
- **单位设置**：AC币、人民币等
- **规则管理**：添加、删除和排序规则

#### 3.3.3 机器人小程序
- **弹幕朗读**：文本转语音、语音合成、队列管理
- **自定义规则**：文本规则、变量规则、语音规则
- **配置选项**：朗读类型、语速控制、音量控制

#### 3.3.4 其他小程序
- **录像小程序**：直播录制、录制管理、录制设置
- **表情管理小程序**：表情开关控制、数量限制、预览和管理
- **弹幕设置增强小程序**：样式编辑、代码级样式编辑、外挂弹幕姬
- **记录管理小程序**：直播记录展示、下载链接管理、时间格式化
- **推流监控小程序**：房间信息展示、实时数据统计、状态监控
- **弹幕网页小程序**：布局结构、显示控制、弹幕效果、实时更新

#### 3.3.5 快捷键设置
- **全局快捷键**：自定义常用功能的快捷键
- **分区快捷键**：为不同功能模块设置专用快捷键

## 4. 交互流程设计

### 4.1 登录流程
1. 启动应用，进入登录页面
2. 显示登录二维码
3. 用户使用ACFUN手机客户端扫描二维码
4. 手机端确认登录
5. 应用验证登录信息，成功后跳转至首页

### 4.2 开播流程
1. 登录后进入首页
2. 点击"开始直播"按钮
3. 进入房间设置页面，配置封面、标题、分区
4. 进入推流设置页面，选择推流方式（OBS同步或手动配置）
5. 点击"开始推流"按钮，启动直播
6. 直播过程中可监控推流状态和观众互动
7. 点击"结束直播"按钮，结束直播并生成直播报告

### 4.3 弹幕管理流程
1. 进入弹幕设置页面
2. 配置弹幕过滤规则（关键词、黑名单）
3. 调整弹幕显示样式（字体、颜色、速度）
4. 直播过程中实时查看和管理弹幕
5. 可手动屏蔽特定用户或关键词

## 5. 数据指标定义

### 5.1 核心业务指标
- 直播时长：用户使用工具进行直播的总时长
- 香蕉数量
- 礼物数量
- 点赞数量
- 礼物价值
- 弹幕数量

### 5.2 体验指标
- 登录成功率：成功完成登录的用户比例
- 开播准备时间：从打开应用到开始推流的平均时间
- 响应时间：页面切换和操作的平均响应时间
- 错误率：操作失败次数与总操作次数的比例
- 用户满意度：通过问卷或反馈收集的用户满意度评分

## 6. 非功能需求

### 6.1 性能需求
- 启动时间：≤10秒
- 页面加载时间：≤2秒
- 弹幕处理能力：≥1000条/秒
- 内存占用：≤500MB
- CPU使用率：≤20%

### 6.2 安全性需求
- 数据加密：用户信息和认证数据必须加密存储和传输
- 直播码安全：直播码定期刷新，不在日志中明文记录
- 权限控制：严格的功能权限检查
- 防注入攻击：输入验证和过滤
- 开源安全：定期进行代码安全审计

### 6.3 兼容性需求
- 操作系统：Windows 7+、macOS 10.13+、Linux (Ubuntu 18.04+)
- 浏览器：Chrome 80+、Firefox 75+、Safari 13+、Edge 80+
- 推流软件：OBS Studio 25+、Streamlabs OBS
- 屏幕分辨率：支持1080p、720p、480p等主流分辨率

### 6.4 可维护性需求
- 代码规范：遵循Vue.js和TypeScript最佳实践
- 文档完善：API文档、开发文档、用户手册
- 模块化设计：功能模块解耦，便于维护和扩展
- 测试覆盖：单元测试覆盖率≥60%，核心功能集成测试覆盖

## 7. 具体场景描述

### 7.1 场景一：日常直播
**角色**：主播
**场景描述**：主播小明准备进行日常直播。他打开ACFUN直播工具箱，扫码登录后，设置房间封面、标题和分区，连接OBS开始推流。直播过程中，他通过工具箱监控观众数量和弹幕，使用关键词过滤功能屏蔽不良言论，并启动了点歌小程序增加观众互动。直播结束后，他查看了直播数据报告，了解观众来源和礼物收入情况。

### 7.2 场景二：特殊活动直播
**角色**：主播、管理员
**场景描述**：主播小红准备进行一场粉丝答谢直播活动。她提前使用工具箱配置了活动主题房间封面和标题，并设置了抽奖小程序。管理员通过后台监控直播内容，确保符合平台规范。直播过程中，小红通过弹幕系统与粉丝互动，使用超级聊功能突出显示粉丝留言，并通过抽奖小程序抽取幸运观众。活动结束后，小红导出了直播录像用于后续宣传。

## 8. 用户角色分析

### 8.1 主播
- **核心需求**：便捷的直播管理、高效的观众互动、丰富的扩展功能
- **使用频率**：高频（每日/每周使用）
- **技能水平**： varies from 新手到专业主播
- **痛点**：开播流程复杂、弹幕管理困难、缺乏数据分析工具

### 8.2 管理员
- **核心需求**：内容监管、权限控制、数据统计
- **使用频率**：中频（每周/每月使用）
- **技能水平**：专业
- **痛点**：缺乏高效的监管工具、权限管理复杂

### 8.3 开发者
- **核心需求**：二次开发支持、API文档、开发工具
- **使用频率**：低频（按需使用）
- **技能水平**：技术专家
- **痛点**：开发文档不完善、API不稳定

## 9. 注意事项
- 直播码每次开播会自动刷新，确保安全性
- OBS连接需要正确配置，详情请参考官方文档
- 部分功能需要管理员权限运行
- 定期更新应用以获取最新功能和安全修复