### 小程序管理
所有小程序统一由 `D:\Code\acfun-live-toolbox-MKII\packages\main\src\utils\AppManager.ts` 文件中的 `AppManager` 类进行管理，该管理器负责小程序的加载、挂载以及与主客户端的交互协调等操作。

### 主客户端与小程序交互流程
以下详细阐述主客户端与小程序之间完整的交互流程：

#### 1. 主客户端启动
主客户端程序开始初始化，加载必要的系统资源和基础配置，为后续与小程序的交互做好准备。

#### 2. 扫描小程序文件夹目录
主客户端启动后，会自动扫描预先设定的小程序文件夹目录，查找所有可用的小程序。这一步骤会遍历目录下的所有子文件夹，识别出符合条件的小程序项目。

#### 3. 加载并挂载小程序
- **默认加载方式**：主客户端会尝试获取每个小程序文件夹中的 `index.html` 文件。默认情况下，该文件被认为是打包好的单页面应用（SPA）文件，获取后会通过 `AppManager` 进行挂载操作，将小程序集成到主客户端的运行环境中。
- **多显示支持配置**：若在小程序文件夹同目录下存在 `config.json` 文件，且该文件中定义了多个 `supportedDisplays` 配置项，主客户端会根据不同的显示需求，通过末端路径（如 `\obs`、`\main`、`\client` 等）加载对应的小程序资源。

#### 4. 生命周期事件与消息总线
- **生命周期事件**：在主客户端执行启动弹幕、启动直播、关闭弹幕、关闭直播等关键活动时，会触发相应的生命周期事件。这些事件代表了主客户端在不同运行阶段的状态变化。
- **消息总线建立**：小程序在启动时会与主客户端建立消息总线，这是两者之间进行通信的重要通道。主客户端触发的生命周期事件会统一通过 `EventSource` 机制下发给小程序，确保小程序能够及时响应主客户端的状态变化。

#### 5. 主客户端启动小程序选择
在主客户端启动小程序时，可根据需求选择不同的启动路径：
- **`\main` 路径**：若选择 `\main` 路径启动小程序，小程序会直接在主客户端的路由页面中运行，成为主客户端界面的一部分。
- **`\client` 路径**：若选择 `\client` 路径启动小程序，主客户端会控制新建一个独立窗口，小程序将在该新窗口中运行。

#### 6. OBS 端小程序加载
在 OBS 端，小程序默认通过 `\obs` 路径进行加载。需要注意的是，通过 `\obs` 路径加载的小程序具有运行环境限制，只能在 OBS 端运行，无法在主客户端等其他环境中使用。
